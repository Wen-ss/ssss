<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¼ æ ‡ç‚¹å‡»ç‰¹æ•ˆ</title>
  <link rel="stylesheet" href="https://at.alicdn.com/t/font_1743249_grf4shm1g3t.css">
  <style>
    html {
      cursor: pointer;
    }

    h3 {
      text-align: center;
      user-select: none;
    }

    .div-box {
      width: 30px;
      height: 30px;
      font-size: 30px;
      position: absolute;
    }

    body {
      padding: 0px;
      margin: 0px;
      background: #222;
      font-family: 'Karla', sans-serif;
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }

    .title {
      z-index: 1000;
      position: fixed;
      bottom: 12px;
      right: 12px;
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      border: 2px solid #fff;
      padding: 7.5px 15px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 3px;
      overflow: hidden;
    }

    h1 {
      text-align: right;
      font-size: 46px;
    }

    h2 {
      font-size: 36px;
    }

    canvas {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div class="title">
    <h2>æ¯å¤©éƒ½è¦ï¼š</h2>
    <h1>è®°å¾—å¼€å¿ƒğŸ˜ƒ</h1>
    <p>ç‚¹å‡»å±å¹•æœ‰â™¥â™¥</p>
  </div>
  <!-- çƒŸèŠ±æ¸²æŸ“åŒº -->
  <canvas></canvas>
  <script>
    window.onclick = function (e) {
      //å­˜å‚¨éœ€è¦çš„é¢œè‰²
      let arr = ["red", "yellow", "green", "pink", "blue", "purple", "orangered"];
      //éšæœºäº§ç”Ÿä¸€ä¸ªé¢œè‰²
      let heartNum = Math.floor(Math.random() * arr.length);
      let div = document.createElement("div");
      div.setAttribute("class", "iconfont iconzan div-box");
      div.style.color = arr[heartNum];
      document.body.appendChild(div);
      //è·å¾—é¼ æ ‡çš„x,yè½´çš„ä½ç½®ï¼Œå¹¶å‡å»è‡ªèº«å®½é«˜çš„ä¸€åŠï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨çˆ±å¿ƒçš„æ­£ä¸­å¿ƒ
      let x = e.pageX - div.offsetWidth / 2;
      let y = e.pageY - div.offsetHeight / 2;
      div.style.left = x + "px";
      div.style.top = y + "px";
      //è·å¾—0-1çš„æ•´æ•°
      let num = Math.round(Math.random());
      let timer = setInterval(() => {
        y -= 10;
        if (num === 0) x -= 10;
        else x += 10;
        div.style.left = x + "px";
        div.style.top = y + "px";
        //å¦‚æœè¶…å‡ºå±å¹•èŒƒå›´ï¼Œåˆ™åˆ é™¤æ­¤èŠ‚ç‚¹å¹¶æ¸…é™¤è¯¥èŠ‚ç‚¹çš„å®šæ—¶å™¨
        if (y < -100) {
          clearInterval(timer);
          div.remove();
        }
      }, 100);
    }


    // è·å– canvas ä¸Šä¸‹æ–‡ï¼Œå¹¶æŒ‡å®šå®½é«˜
    let ctx = document.querySelector('canvas').getContext('2d')
    ctx.canvas.width = window.innerWidth
    ctx.canvas.height = window.innerHeight

    // åˆå§‹ç»½æ”¾æ•°
    const OVERLAP_NUM = 66
    // åˆ·æ–°é€Ÿåº¦ ms
    const TIME_STEP = 16
    // çƒŸèŠ±ç§»åŠ¨çš„é€Ÿåº¦ä¸æ–¹å‘æ§åˆ¶
    const WALK = 0.2

    // ç«èŠ±æ•°ç»„
    let sparks = []
    // çƒŸèŠ±æ•°ç»„
    let fireworks = []

    // åˆå§‹çˆ†ç‚¸çš„å¡«å……é€»è¾‘
    for (let i = 0; i < OVERLAP_NUM; i++) {
      // å¡«å……
      fireworks.push(
        // æ„å»ºéšæœºä½ç½®
        new Firework(
          Math.random() * window.innerWidth,
          Math.random() * window.innerHeight
        )
      )
    }

    /**
     * æ¸²æŸ“å‡½æ•°
     */
    function render () {
      // å¤œå¹•èƒŒæ™¯è‰²ä¸åŒºåŸŸ
      ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'
      ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)

      // çƒŸèŠ±ä¸Šå‡
      for (let firework of fireworks) {
        if (firework.over) {
          continue
        }
        firework.move()
        firework.draw()
      }

      // ç«èŠ±ä¸‹å 
      for (let spark of sparks) {
        if (spark.over) {
          continue
        }
        spark.move()
        spark.draw()
      }

      // é€šè¿‡éšæœºæ•°æ¥æ§åˆ¶çƒŸèŠ±äº§ç”Ÿé€Ÿåº¦
      if (Math.random() < 0.05) {
        fireworks.push(new Firework())
      }

      // é‡å¤æ¸²æŸ“
      setTimeout(render, TIME_STEP)
    }

    /**
     * ç«èŠ±æ„é€ 
     */
    function Spark (x, y, color) {
      // æ ‡è®°ç»½æ”¾ç‚¹ä½ç½®ä¸è‰²å€¼
      this.x = x
      this.y = y
      this.color = color
      // ä½ç½®
      this.dir = Math.random() * (Math.PI * 2)
      // æ‰§è¡Œå®Œæ¯•
      this.over = false
      // ç«èŠ±å´©è£‚é€Ÿåº¦
      this.speed = Math.random() * 3 + 3
      // ç«èŠ±ä¸‹å çš„é€Ÿåº¦
      this.gravity = Math.random() + 0.1
      // ç«èŠ±æ¶ˆå¤±çš„é€Ÿåº¦
      this.countdown = this.speed * 10
      /**
       * ç«èŠ±ç§»åŠ¨æ–¹æ³•
       */
      this.move = function () {
        // å€’è®¡æ—¶å¤„ç†
        this.countdown--
        if (this.countdown < 0) {
          this.over = true
        }

        // é€Ÿåº¦é€’å‡
        if (this.speed > 0) {
          this.speed -= 0.1
        }

        if (this.speed < 0) {
          return
        }

        // xã€y åæ ‡ä½ç½®
        this.x += Math.cos(this.dir + WALK) * this.speed
        this.y += Math.sin(this.dir + WALK) * this.speed
        this.y += this.gravity
        // ä¸‹å é€Ÿåº¦åŠ å¿«
        this.gravity += 0.05
      }
      /**
       * ç»˜åˆ¶
       */
      this.draw = function () {
        drawCircle(this.x, this.y, 3, this.color)
      }
    }

    /**
     * çƒŸèŠ±æ„é€ 
     */
    function Firework (x, y) {
      // åˆå§‹ç‚¹
      this.x = x || Math.random() * ctx.canvas.width
      this.y = y || ctx.canvas.height
      // ç»½æ”¾ç‚¹
      this.burstLocation = (Math.random() * ctx.canvas.height) / 2
      // ç»½æ”¾æ˜¯å¦å·²å®Œæ¯•
      this.over = false
      // çƒŸèŠ±è‰²
      this.color = randomColor()

      /**
       * ç§»åŠ¨çš„æ–¹æ³•
       */
      this.move = function () {
        // æ¨ªå‘åç§»
        this.x += WALK
        // ä¸Šå‡ä¸ç»½æ”¾
        if (this.y > this.burstLocation) {
          this.y -= 1
        } else {
          this.burst()
        }
      }

      /**
       * æŒç»­ç»˜åˆ¶
       */
      this.draw = function () {
        drawCircle(this.x, this.y, 1.5, this.color)
      }
      /**
       * ç»½æ”¾æ–¹æ³•
       */
      this.burst = function () {
        // æ ‡è®°ç»½æ”¾å®Œæ¯•
        this.over = true
        // ç¢è£‚çƒŸèŠ±æ•°
        let i = Math.floor(Math.random() * 150) + 10
        // æ„å»ºç¢è£‚å¯¹è±¡
        while (i--) {
          sparks.push(new Spark(this.x, this.y, this.color))
        }
      }
    }

    /**
     * æŒç»­ç»˜åˆ¶
     */
    function drawCircle (x, y, radius, color) {
      color = color
      ctx.fillStyle = color
      ctx.fillRect(x - radius / 2, y - radius / 2, radius, radius)
    }

    /**
     * ç”Ÿæˆéšæœºè‰²å€¼
     */
    function randomColor () {
      const r = Math.floor(Math.random() * 255)
      const g = Math.floor(Math.random() * 255)
      const b = Math.floor(Math.random() * 255)
      return `rgb(${r},${g},${b})`
    }

    // å¼€å§‹
    render()
  </script>
</body>

</html>